<?php

function hook_perm() {
  return array('administer Orphan Object Adminstration');
}

/**
* Implementation of hook_menu()
*/
function orphan_object_menu() {
  $items = array();
  $items['admin/content/orphan-object'] = array(
    'title' => t('Orphan Object Administration'),
    'page callback' => 'orphan_object_form',
	'access callback' => 'user_access',
    'access arguments' => array('administer Orphan Object Adminstration'),
    'description' => t('Administrative Interface for management of Orphaned Fedora Objects'),
  );
  return $items;
}

/**
* Generates a page for the form
*/
function orphan_object_form() {

  // Form builder call to build the form
  return drupal_get_form('orphan_object_formpage');

}

/**
* Builds the orphan_object form
*/
function orphan_object_formpage($form_state) {
   
    // Fieldset to hold form contents
  $orphans = array
  (
    array('oid' => 0, 'title' => '<a href = "http://192.168.56.195/fedora/repository/islandora:2216/-/Heart%20Beat">Heart Beat</a>', 'identifier' => 'islandora:2216'),
    array('oid' => 1, 'title' => '<a href = "http://192.168.56.195/fedora/repository/islandora:2221/-/Elmsdale">Elmsdale</a>', 'identifier' => 'islandora:2221'),
  );

  foreach($orphans as $orphan)
  {
    $active[$orphan['oid']] = ''; 
    $form[$orphan['oid']]['title'] = array 
    (
      '#value' => $orphan['title'],
    );
    $form[$orphan['oid']]['identifier'] = array 
    (
      '#value' => $orphan['identifier'],
    );
  } 
	
  $form['active'] = array(
    '#type' => 'checkboxes',
	'#options' => $active,
	'#default_value' = $active,
  );
  
  $form['submit'] = array(
    '#type' => 'submit',
	'#value' => 'Save Configuration',
  );
  
  $form['#theme'] = 'orphan_object_theme'; 
  
  return $form;
}

function orphan_object_theme(){
  return array
  (
    'orphan_object_theme' => array
	(
	  'arguments' => array('form' => NULL)
	),
  );
}
  
function theme_orphan_object_theme($form){
  $rows = array();

  foreach(element_children($form['active']) as $oid){
    $row = array(); 
    $row[] = drupal_render($form['active'][$oid]); 
    $row[] = drupal_render($form[$oid]['title']); 
    $row[] = drupal_render($form[$oid]['identifier']); 
    $rows[] = $row;
  }
  
  if(count($rows)){
    $header = array(t('Active'), t('Object Title'), t('Identifier')); 
  }
  else{
    $header = array(t('Active'), t('Object Title'), t('Identifier')); 
    $row = array();
    $row[] = array
    (
      'data' => t('No Orphans were found'),
      'colspan' => 2,
      'style' => 'text-align:center',
    );
    $rows[] = $row;
  }
  
  $output = theme('table', $header, $rows);
  $output .=drupal_render($form);
  return $output;  
}